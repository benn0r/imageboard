<!-- required scripts -->
<script type="text/javascript" src="<?php echo $this->baseUrl() ?>javascripts/jquery/fileinput.js"></script>

<!-- required stylehsheets -->
<link rel="stylesheet" type="text/css" href="<?php echo $this->baseUrl() ?>styles/jquery/fileinput.css" />

<script type="text/javascript">
	function submituploadform(form, target) {
		var form = $(form);
		form.find('.input-default').each(function() {
			$(this).val('');
		})

		return submitform(form, target);
	}

	/**
	 * Called form uploadiframe and share button
	 */
	function uploadedmedia(html) {
		/* clear error */
		$('#upload-error').html('');
		$('#media-shared').hide();
		$('#media-shared').html(html);
		$('#media-shared').fadeIn();
	}

	function addmedia(html) {
		$('#media').append(html);
	}

	function uploaderror(html) {
		$('#upload-error').hide();
		$('#upload-error').html(html);
		$('#upload-error').fadeIn();

		$('.customfile-feedback').removeClass('customfile-feedback-populated');
		$('.customfile-feedback').html(t.upload.nofile);
	}

	function cancel() {
		$.get(BASE_URL + 'upload/form', function(html) {
			uploadedmedia(html);
		});

		return false;
	}
</script>

<div class="page-header">
	<h2><?php echo $this->t->t('upload/title') ?></h2>
</div>

<?php if(!$this->user): ?>
	<div class="alert-message block-message info">
		<p><?php echo $this->t->t('upload/loggedout') ?></p>
	</div>
<?php endif; ?>

<script type="text/javascript">
$(document).ready(function() {
	$('#url,#file').change(function() {
		$('#shareform').submit();
	});
});
</script>

<iframe name="upload-iframe" class="upload-iframe"></iframe> 

<form method="post" action="<?php echo $this->baseUrl() ?>upload" enctype="multipart/form-data" target="upload-iframe" id="shareform">
	<?php echo $this->render('upload', 'uploadform') ?>
</form>
<form method="post" action="<?php echo $this->baseUrl() ?>upload/create" onsubmit="return submituploadform(this, $('#layer-upload'))">
	<fieldset>
		
		<legend><?php echo $this->t->t('upload/contenttitle') ?></legend>
		
		<div class="clearfix">
			<label for="comment"><?php echo $this->t->t('upload/writecomment') ?></label>
			<div class="input">
				<textarea id="comment" name="comment" rows="5" class="span6"></textarea>
			</div>
		</div>
		
		<div class="clearfix">
			<label><?php echo $this->t->t('upload/options') ?></label>
			<div class="input">
				<ul class="inputs-list">
	                <li>
                  		<label>
                    		<input type="checkbox" name="abothread" checked="checked" />
                    		<span data-placement="right" rel='twipsy' title='<?php echo $this->t->t('upload/abothreadhelp') ?>'><?php echo $this->t->t('upload/abothread') ?></span>
                  		</label>
	                </li>
	                <li>
                  		<label>
                    		<input type="checkbox" name="forwardthread" checked="checked" />
                    		<span><?php echo $this->t->t('upload/forwardthread') ?></span>
                  		</label>
	                </li>
	        	</ul>
			</div>
		</div>

		<div class="actions">
			<button name="save" class="btn primary" data-loading-text="<?php echo $this->t->t('upload/saving') ?>"><?php echo $this->t->t('upload/publish') ?></button>
		</div>
		
	</fieldset>
</form>

<script type="text/javascript">
	var formid = '<?php echo $formid ?>';
	
	$('#'+formid+' .share-url').bind('paste', function() {
		var elem = $(this);
		setTimeout(function() {
			// click event auslösen wenn wir einen paste event bemerken
			$('#share-link').click();
		}, 100);
	});

	$('#comment').autoResize({
	    // On resize:
	    onResize : function() {
	        $(this).css({opacity:0.8});
	    },
	    // After resize:
	    animateCallback : function() {
	        $(this).css({opacity:1});
	    },
	    // Quite slow animation:
	    animateDuration : 300,
	    // More extra space:
	    extraSpace : 0,
	    limit : 400,
	});

	$('*[rel=twipsy]').twipsy();

	$('.input-default').mousedown(mouseevent);
	$('.input-default').focus(mouseevent);
</script>